---
title: 30-day preauth
'og:title': '30-day card preauthorization - Mangopay docs'
"og:description": "How to place a hold on a card and capture the amount within 30 days."
---

import RestCreateDepositPreauthorization from '/snippets/code/rest-create-deposit-preauthorization.mdx';
import PhpCreateDepositPreauthorization from '/snippets/code/php-create-deposit-preauthorization.mdx';
import JavaCreateDepositPreauthorization from '/snippets/code/java-create-deposit-preauthorization.mdx';
import PythonCreateDepositPreauthorization from '/snippets/code/python-create-deposit-preauthorization.mdx';
import NetCreateDepositPreauthorization from '/snippets/code/net-create-deposit-preauthorization.mdx';

import RestCreateDepositPreauthorizedPayin from '/snippets/code/rest-create-deposit-preauthorized-payin.mdx';
import PhpCreateDepositPreauthorizedPayin from '/snippets/code/php-create-deposit-preauthorized-payin.mdx';
import JavaCreateDepositPreauthorizedPayin from '/snippets/code/java-create-deposit-preauthorized-payin.mdx';
import PythonCreateDepositPreauthorizedPayin from '/snippets/code/python-create-deposit-preauthorized-payin.mdx';
import NetCreateDepositPreauthorizedPayin from '/snippets/code/net-create-deposit-preauthorized-payin.mdx';

import RestCancelOrValidatePreauthorization from '/snippets/code/rest-cancel-or-validate-preauthorization.mdx';
import PhpCancelDepositPreauthorization from '/snippets/code/php-cancel-deposit-preauthorization.mdx';
import JavaCancelValidatePreauthorization from '/snippets/code/java-cancel-validate-preauthorization.mdx';
import PythonCancelDepositPreauthorization from '/snippets/code/python-cancel-deposit-preauthorization.mdx';
import NetCancelDepositPreauthorization from '/snippets/code/net-cancel-deposit-preauthorization.mdx';

**Availability:**

* `CB_VISA_MASTERCARD` only

<Note>
**Note - Multi-capture not possible with 30-day preauthorization**

Multi-capture is only available for 7-day preauthorization.
</Note>

Mangopay's 30-day preauthorization feature is a two-step process, and uses two API objects:
- The Deposit Preauthorization to request the card authorization, which involves the user completing 3DS
- The Deposit Preauthorized PayIn to capture the funds without the user present and based on the authorization

## How to process a 30-day card preauthorization


<Info>
  **Prerequisites**

  * A `ClientId` and an API key – if you don't have these, <a href="https://mangopay.com/contact" target="_blank">contact Sales</a> to get access to the <a href="https://hub.mangopay.com/" target="_blank">Mangopay Dashboard</a>
  * A User object created for your end user, and their associated Wallet
  * A <a href="/guides/payment-methods/card">registered card</a> (CB, Visa, or Mastercard), which is `VALID` or registered less than 24 hours ago, to make the payments
  * The URL of a page on your platform to return the end user to after authentication
</Info>

### 1. Secure the funds

Create a deposit preauthorization to hold funds for 30 days:

> [**POST** /v2.01/\{ClientId}/deposit-preauthorizations/card/direct](/api-reference/deposit-preauthorizations/create-deposit-preauthorization)

<CodeGroup>
    <RestCreateDepositPreauthorization />
    <PhpCreateDepositPreauthorization />
    <JavaCreateDepositPreauthorization />
    <PythonCreateDepositPreauthorization />
    <NetCreateDepositPreauthorization />
</CodeGroup>

In the information returned, retain the `Id` of the Deposit Preauthorization for the next steps.

### 2. Redirect the user to 3DS protocol (if required)

Redirect the user to the `SecureModeRedirectURL` value to complete strong customer authentication, unless it is `null`. If `SecureModeRedirectURL` is `null`, this means that 3DS is not required and no redirection is needed.

You can also use the `SecureModeNeeded` boolean to determine this redirection behavior.

For more information on how to handle 3DS redirection, see Steps 4, 6, and 7 of the <a href="/guides/payment-methods/card/direct/how-to">How to process a card payment</a> guide.

### 3. Capture the funds

Once the Deposit Preauthorization's `PaymentStatus` is `WAITING`, the funds are authorized to be captured within 29.5 days.

<Note>
  **Note - Multiple captures not possible**

  Capturing the preauthorized amount can only be done once. It is possible to do a partial capture (for an amount less than the preauthorized amount).
</Note>

To capture the funds, create the pay-in using the `Id` of the Deposit Preauthorization obtained previously as the `DepositId`.

Specify the `Amount` values of debited funds and fees. The amount of the `DebitedFunds` must be less than or equal to the preauthorized amount.

> [**POST** /v2.01/\{ClientId}/payins/deposit-preauthorized/direct/full-capture](/api-reference/deposit-preauthorizations/create-deposit-preauthorized-payin)

<CodeGroup>
<RestCreateDepositPreauthorizedPayin />
<PhpCreateDepositPreauthorizedPayin />
<JavaCreateDepositPreauthorizedPayin />
<PythonCreateDepositPreauthorizedPayin /> 
<NetCreateDepositPreauthorizedPayin />
</CodeGroup>

If the preauthorized pay-in is successful, the deposit preauthorization’s `PaymentStatus` becomes `VALIDATED`. In the `PayinsLinked` parameter, the `Id` of the capture is linked as the `PayinCaptureId`.

You can set up a webhook for the following event type to be notified of the status change:

* DEPOSIT\_PREAUTHORIZATION\_PAYMENT\_VALIDATED

Use the [GET View a Deposit Preauthorization](/api-reference/deposit-preauthorizations/view-deposit-preauthorization) endpoint to see these details.

```json API response
...
    "PaymentStatus": "VALIDATED",
    "PayinsLinked": {
        "PayinCaptureId": "1719d157-5a97-4af3-91b0-7d660b34b21c",
        "PayinComplementId": null
    },
...
```

Once the `PaymentStatus` is `VALIDATED`, no further action is possible.

### 4. Cancel hold if not used

In the scenario where the capture is not needed, you should release the user's funds proactively rather than letting the hold expire after 29.5 days.

You can release the preauthorized funds by changing the Deposit Preauthorization's `PaymentStatus` to `CANCELED`:

> [**PUT** /v2.01/\{ClientId}/deposit-preauthorizations/\{DepositId}](/api-reference/deposit-preauthorizations/cancel-deposit-preauthorization)

<CodeGroup>
<RestCancelOrValidatePreauthorization />
<PhpCancelDepositPreauthorization />
<JavaCancelValidatePreauthorization />
<PythonCancelDepositPreauthorization />  
<NetCancelDepositPreauthorization />
</CodeGroup>

Once the `PaymentStatus` is `CANCELED`, no further action is possible.

```json API response parameters - Canceled
...
    "PaymentStatus": "CANCELED",
    "PayinsLinked": {
        "PayinCaptureId": null,
        "PayinComplementId": null
    },
...
```

You can set up a webhook for the following event types to be notified of the status changes:

* DEPOSIT\_PREAUTHORIZATION\_PAYMENT\_CANCEL\_REQUESTED
* DEPOSIT\_PREAUTHORIZATION\_PAYMENT\_CANCELED

## Related resources

<CardGroup col={2}>
<Card title="Guide" href="/guides/payment-methods/card/direct/how-to">
Learn how to process a one-time card payment
</Card>
<Card title="Endpoint" href="/api-reference/deposit-preauthorizations/deposit-preauthorization-object">
The Deposit Preauthorization object
</Card>
</CardGroup>
